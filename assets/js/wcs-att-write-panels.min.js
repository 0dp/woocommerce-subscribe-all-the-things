jQuery(function(t){function n(){var n=t("select#product-type").val(),e=s.find(".subscription_scheme").length;"subscription"!==n&&"variable-subscription"!==n&&(e>0?t(".subscription_one_time_shipping").show():t(".subscription_one_time_shipping").hide())}function e(){s.find(".subscription_scheme").each(function(n,e){t(".position",e).val(parseInt(t(e).index(".subscription_schemes .subscription_scheme")))})}var i=t("#wcsatt_data"),s=i.find(".subscription_schemes"),c={message:null,overlayCSS:{background:""!==wcsatt_admin_params.post_id?"#fff":"#f1f1f1",opacity:.6}};t.fn.wcsatt_scripts=function(){t(this).find(".help_tip, .tips, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},t.fn.wcsatt_refresh_scheme_lengths=function(){var n=t(this).find(".wc_input_subscription_length"),e=t(this).find(".wc_input_subscription_period"),i=t(this).find(".wc_input_subscription_period_interval"),s=n.val(),c=parseInt(i.val()),o=!1;n.empty(),t.each(wcsatt_admin_params.subscription_lengths[e.val()],function(e,i){0!=parseInt(e)&&0!=parseInt(e)%c||n.append(t("<option></option>").attr("value",e).text(i))}),n.children("option").each(function(){if(this.value==s)return o=!0,!1}),o?n.val(s):n.val(0)},""===wcsatt_admin_params.post_id&&(i.on("click","h3",function(){var n=t(this).closest(".wc-metabox"),e=n.find(".wc-metabox-content");n.hasClass("closed")?e.show():e.hide(),n.toggleClass("closed")}),i.find(".wc-metabox").each(function(){var n=t(this),e=n.find(".wc-metabox-content");n.hasClass("closed")&&e.hide()})),t.fn.wcsatt_refresh_sync_options=function(){var n=t(this).find(".wc_input_subscription_period"),e=t(this).find(".subscription_sync"),i=e.find(".subscription_sync_annual");$syncWeekMonthContainer=e.find(".subscription_sync_week_month"),$syncWeekMonthSelect=$syncWeekMonthContainer.find("select"),billingPeriod=n.val(),"day"===billingPeriod?(e.hide(),$syncWeekMonthSelect.val(0),i.find('input[type="number"]').val(0)):(e.show(),"year"===billingPeriod?($syncWeekMonthContainer.hide(),i.find('input[type="number"]').val(0),$syncWeekMonthSelect.val(0),i.show()):(i.hide(),i.find('input[type="number"]').val(0),$syncWeekMonthSelect.empty(),t.each(WCSubscriptions.syncOptions[billingPeriod],function(n,e){$syncWeekMonthSelect.append(t("<option></option>").attr("value",n).text(e))}),$syncWeekMonthContainer.show()))},i.on("woocommerce_subscription_schemes_changed",function(){n()}),t("select#product-type").change(function(){n()}).change(),s.on("change","select.subscription_pricing_method_input",function(){var n=t(this).val();t(this).closest(".subscription_scheme_product_data").find(".subscription_pricing_method").hide(),t(this).closest(".subscription_scheme_product_data").find(".subscription_pricing_method_"+n).show()}),s.find("select.subscription_pricing_method_input").change(),i.find("input#_wcsatt_force_subscription").on("change",function(){t(this).is(":checked")?i.find(".wcsatt_default_status").hide():i.find(".wcsatt_default_status").show()}).change(),s.on("change",".wc_input_subscription_period",function(){t(this).closest(".subscription_scheme").wcsatt_refresh_scheme_lengths(),t(this).closest(".subscription_scheme").wcsatt_refresh_sync_options()}),i.on("click","span.scheme-remove",function(){var n=t(this).closest(".subscription_scheme");return n.find("*").off(),n.remove(),e(),i.trigger("woocommerce_subscription_schemes_changed"),!1}),i.on("click",".expand_all",function(){return s.find(".wc-metabox > .wc-metabox-content").show(),!1}),i.on("click",".close_all",function(){return s.find(".wc-metabox > .wc-metabox-content").hide(),!1});var o=i.find(".wc-metabox").length;i.on("click","button.add_subscription_scheme",function(){i.block(c),o++;var n={action:"wcsatt_add_subscription_scheme",post_id:wcsatt_admin_params.post_id,index:o,security:wcsatt_admin_params.add_subscription_scheme_nonce};return t.post(wcsatt_admin_params.wc_ajax_url,n,function(n){s.append(n.markup);var c=s.find(".subscription_scheme").last();c.wcsatt_scripts(),t("input#_virtual").change(),c.find("select.subscription_pricing_method_input").change(),e(),i.unblock(),i.trigger("woocommerce_subscription_scheme_added",n),i.trigger("woocommerce_subscription_schemes_changed")},"json"),!1}),function(){var n=s.find(".subscription_scheme").get();n.sort(function(n,e){var i=parseInt(t(n).attr("rel")),s=parseInt(t(e).attr("rel"));return i<s?-1:i>s?1:0}),t(n).each(function(t,n){s.append(n)}),s.sortable({items:".subscription_scheme",cursor:"move",axis:"y",handle:"span.scheme-handle",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,n){n.item.css("background-color","#f6f6f6")},stop:function(t,n){n.item.removeAttr("style"),e()}})}()});