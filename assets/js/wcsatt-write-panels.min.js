jQuery(function(a){function b(){e.find(".subscription_scheme").each(function(b,c){a(".position",c).val(parseInt(a(c).index(".subscription_schemes .subscription_scheme")));var d="#"+(b+1).toString();a(".scheme-title",c).html(d)})}function c(){var c=e.find(".subscription_scheme").get();c.sort(function(b,c){var d=parseInt(a(b).attr("rel")),e=parseInt(a(c).attr("rel"));return e>d?-1:d>e?1:0}),a(c).each(function(a,b){e.append(b)}),e.sortable({items:".subscription_scheme",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,c){c.item.removeAttr("style"),b()}})}var d=a("#wcsatt_data"),e=d.find(".subscription_schemes"),f={message:null,overlayCSS:{background:""!==wcsatt_admin_params.post_id?"#fff":"#f1f1f1",opacity:.6}};a.fn.wcsatt_scripts=function(){a(this).find(".help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},a.fn.wcsatt_refresh_scheme_lengths=function(){var b=a(this).find(".wc_input_subscription_length"),c=a(this).find(".wc_input_subscription_period"),d=a(this).find(".wc_input_subscription_period_interval"),e=b.val(),f=parseInt(d.val()),g=!1;b.empty(),a.each(wcsatt_admin_params.subscription_lengths[c.val()],function(c,d){(0==parseInt(c)||0==parseInt(c)%f)&&b.append(a("<option></option>").attr("value",c).text(d))}),b.children("option").each(function(){return this.value==e?(g=!0,!1):void 0}),g?b.val(e):b.val(0)},""===wcsatt_admin_params.post_id&&(d.on("click","h3",function(){var b=a(this).closest(".wc-metabox"),c=b.find(".wc-metabox-content");b.hasClass("closed")?c.show():c.hide(),b.toggleClass("closed")}),d.find(".wc-metabox").each(function(){var b=a(this),c=b.find(".wc-metabox-content");b.hasClass("closed")&&c.hide()})),e.on("change","select.subscription_pricing_method_input",function(){var b=a(this).val();a(this).closest(".subscription_scheme_product_data").find(".subscription_pricing_method").hide(),a(this).closest(".subscription_scheme_product_data").find(".subscription_pricing_method_"+b).show()}),e.find("select.subscription_pricing_method_input").change(),d.find("input#_wcsatt_force_subscription").on("change",function(){a(this).is(":checked")?d.find(".wcsatt_default_status").hide():d.find(".wcsatt_default_status").show()}).change(),e.on("change",".wc_input_subscription_period",function(){a(this).closest(".subscription_scheme").wcsatt_refresh_scheme_lengths()}),d.on("click","button.remove_row",function(){var c=a(this).closest(".subscription_scheme");c.find("*").off(),c.remove(),b()}),d.on("click",".expand_all",function(){return e.find(".wc-metabox > .wc-metabox-content").show(),!1}),d.on("click",".close_all",function(){return e.find(".wc-metabox > .wc-metabox-content").hide(),!1});var g=d.find(".wc-metabox").length;d.on("click","button.add_subscription_scheme",function(){d.block(f),g++;var c={action:"wcsatt_add_subscription_scheme",post_id:wcsatt_admin_params.post_id,index:g,security:wcsatt_admin_params.add_subscription_scheme_nonce};return a.post(wcsatt_admin_params.wc_ajax_url,c,function(a){e.append(a.markup);var c=e.find(".subscription_scheme").last();c.wcsatt_scripts(),c.find("select.subscription_pricing_method_input").change(),b(),d.unblock(),d.trigger("woocommerce_subscription_scheme_added",a)},"json"),!1}),c()});