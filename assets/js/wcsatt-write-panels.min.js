jQuery(function(a){function f(){c.find(".subscription_scheme").each(function(b,c){a(".position",c).val(parseInt(a(c).index(".subscription_schemes .subscription_scheme")))})}function g(){var b=c.find(".subscription_scheme").get();b.sort(function(b,c){var d=parseInt(a(b).attr("rel")),e=parseInt(a(c).attr("rel"));return d<e?-1:d>e?1:0}),a(b).each(function(a,b){c.append(b)}),c.sortable({items:".subscription_scheme",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),f()}})}var b=a("#wcsatt_data"),c=b.find(".subscription_schemes"),d={message:null,overlayCSS:{background:""!==wcsatt_admin_params.post_id?"#fff":"#f1f1f1",opacity:.6}};a("select#product-type").change(function(){var b=a(this).val();("subscription"!=b||"variable-subscription"!=b)&&(c.length>0?a(".subscription_one_time_shipping").show():a(".subscription_one_time_shipping").hide()),a(document.body).trigger("woocommerce-product-type-change",b,a(this))}).change(),a.fn.wcsatt_scripts=function(){a(this).find(".help_tip, .tips, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},a.fn.wcsatt_refresh_scheme_lengths=function(){var b=a(this).find(".wc_input_subscription_length"),c=a(this).find(".wc_input_subscription_period"),d=a(this).find(".wc_input_subscription_period_interval"),e=b.val(),f=parseInt(d.val()),g=!1;b.empty(),a.each(wcsatt_admin_params.subscription_lengths[c.val()],function(c,d){(0==parseInt(c)||0==parseInt(c)%f)&&b.append(a("<option></option>").attr("value",c).text(d))}),b.children("option").each(function(){return this.value==e?(g=!0,!1):void 0}),b.val(g?e:0)},""===wcsatt_admin_params.post_id&&(b.on("click","h3",function(){var b=a(this).closest(".wc-metabox"),c=b.find(".wc-metabox-content");b.hasClass("closed")?c.show():c.hide(),b.toggleClass("closed")}),b.find(".wc-metabox").each(function(){var b=a(this),c=b.find(".wc-metabox-content");b.hasClass("closed")&&c.hide()})),c.on("change","select.subscription_pricing_method_input",function(){var b=a(this).val();a(this).closest(".subscription_scheme_product_data").find(".subscription_pricing_method").hide(),a(this).closest(".subscription_scheme_product_data").find(".subscription_pricing_method_"+b).show()}),c.find("select.subscription_pricing_method_input").change(),b.find("input#_wcsatt_force_subscription").on("change",function(){a(this).is(":checked")?b.find(".wcsatt_default_status").hide():b.find(".wcsatt_default_status").show()}).change(),c.on("change",".wc_input_subscription_period",function(){a(this).closest(".subscription_scheme").wcsatt_refresh_scheme_lengths()}),b.on("click","button.remove_row",function(){var b=a(this).closest(".subscription_scheme");b.find("*").off(),b.remove(),f()}),b.on("click",".expand_all",function(){return c.find(".wc-metabox > .wc-metabox-content").show(),!1}),b.on("click",".close_all",function(){return c.find(".wc-metabox > .wc-metabox-content").hide(),!1});var e=b.find(".wc-metabox").length;b.on("click","button.add_subscription_scheme",function(){b.block(d),e++;var g={action:"wcsatt_add_subscription_scheme",post_id:wcsatt_admin_params.post_id,index:e,security:wcsatt_admin_params.add_subscription_scheme_nonce};return a.post(wcsatt_admin_params.wc_ajax_url,g,function(d){c.append(d.markup);var e=c.find(".subscription_scheme").last();e.wcsatt_scripts(),e.find("select.subscription_pricing_method_input").change(),f(),b.unblock(),b.trigger("woocommerce_subscription_scheme_added",d),a(document.body).trigger("woocommerce-product-type-change")},"json"),!1}),g()});